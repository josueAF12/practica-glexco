name: ğŸ“ Clase GitHub Actions - Conceptos BÃ¡sicos

on:
  workflow_dispatch:  # Se ejecuta manualmente desde GitHub

jobs:
  # JOB 1: ConfiguraciÃ³n inicial
  configuracion:
    name: âš™ï¸ ConfiguraciÃ³n
    runs-on: ubuntu-latest
    
    outputs:
      mensaje: ${{ steps.crear-mensaje.outputs.saludo }}
      timestamp: ${{ steps.obtener-tiempo.outputs.hora }}
    
    steps:
      # STEP 1: Obtener el cÃ³digo
      - name: Obtener cÃ³digo del repositorio
        uses: actions/checkout@v4
        with:
          fetch-depth: 1
      
      # STEP 2: Mostrar informaciÃ³n bÃ¡sica
      - name: Mostrar informaciÃ³n del entorno
        run: |
          echo "ğŸ‘‹ Hola estudiante!"
          echo "Repositorio: ${{ github.repository }}"
          echo "Ejecutado por: ${{ github.actor }}"
          echo "Directorio actual: $(pwd)"
      
      # STEP 3: Crear un archivo simple
      - name: Crear archivo de prueba
        run: |
          echo "Este es un archivo creado en GitHub Actions" > prueba.txt
          echo "Fecha: $(date)" >> prueba.txt
          echo "âœ… Archivo 'prueba.txt' creado"
          cat prueba.txt
      
      # STEP 4: Crear output para compartir
      - name: Crear mensaje personalizado
        id: crear-mensaje
        run: |
          echo "saludo=Â¡Hola desde el job de configuraciÃ³n!" >> $GITHUB_OUTPUT
      
      # STEP 5: Obtener hora actual
      - name: Obtener hora de ejecuciÃ³n
        id: obtener-tiempo
        run: |
          echo "hora=$(date +%H:%M:%S)" >> $GITHUB_OUTPUT

  # JOB 2: Procesamiento (depende del primero)
  procesamiento:
    name: ğŸ”„ Procesamiento de datos
    runs-on: ubuntu-latest
    needs: configuracion  # Espera a que termine 'configuracion'
    
    steps:
      # STEP 1: Mostrar el mensaje del job anterior
      - name: Mostrar mensaje recibido
        run: |
          echo "ğŸ“¨ Mensaje del job anterior:"
          echo "${{ needs.configuracion.outputs.mensaje }}"
          echo "â° Hora: ${{ needs.configuracion.outputs.timestamp }}"
      
      # STEP 2: Procesar archivo
      - name: Contar lÃ­neas del archivo
        run: |
          echo "ğŸ“Š Contando lÃ­neas del archivo prueba.txt:"
          wc -l prueba.txt
          echo "ğŸ“„ Contenido:"
          cat prueba.txt
      
      # STEP 3: Simular trabajo
      - name: Simular tarea de procesamiento
        run: |
          echo "ğŸ”„ Procesando datos..."
          sleep 2  # Esperar 2 segundos (simula trabajo)
          echo "âœ… Procesamiento completado"
      
      # STEP 4: Crear resultado
      - name: Crear archivo de resultados
        run: |
          echo "RESULTADO DEL PROCESAMIENTO" > resultado.txt
          echo "---------------------------" >> resultado.txt
          echo "Estatus: EXITOSO" >> resultado.txt
          echo "Archivos procesados: 1" >> resultado.txt
          echo "Hora: $(date)" >> resultado.txt
          echo "ğŸ“ Archivo 'resultado.txt' creado"

  # JOB 3: VerificaciÃ³n (ejecuta en paralelo con 'procesamiento')
  verificacion:
    name: âœ… VerificaciÃ³n
    runs-on: ubuntu-latest
    needs: configuracion  # TambiÃ©n depende de 'configuracion'
    
    steps:
      # STEP 1: Verificar que tenemos archivos
      - name: Verificar existencia de archivos
        run: |
          echo "ğŸ” Verificando archivos..."
          if [ -f "prueba.txt" ]; then
            echo "âœ… prueba.txt existe"
          else
            echo "âŒ prueba.txt NO existe"
            exit 1
          fi
      
      # STEP 2: Verificar permisos
      - name: Verificar permisos
        run: |
          echo "ğŸ” Verificando permisos:"
          ls -la prueba.txt
      
      # STEP 3: Prueba simple
      - name: Ejecutar prueba
        run: |
          echo "ğŸ§ª Ejecutando prueba simple..."
          echo "Esto es una prueba de concepto"
          echo "2 + 2 = $((2 + 2))"

  # JOB 4: Resumen final (espera a todos)
  resumen-final:
    name: ğŸ“‹ Resumen Final
    runs-on: ubuntu-latest
    needs: [configuracion, procesamiento, verificacion]
    
    steps:
      # STEP 1: Mostrar resumen
      - name: Mostrar resumen de ejecuciÃ³n
        run: |
          echo "========================================"
          echo "          RESUMEN DEL WORKFLOW          "
          echo "========================================"
          echo ""
          echo "ğŸ“Š Jobs ejecutados:"
          echo "  - âš™ï¸  ConfiguraciÃ³n: ${{ needs.configuracion.result }}"
          echo "  - ğŸ”„ Procesamiento: ${{ needs.procesamiento.result }}"
          echo "  - âœ… VerificaciÃ³n: ${{ needs.verificacion.result }}"
          echo ""
          echo "ğŸ“ InformaciÃ³n:"
          echo "  - Repositorio: ${{ github.repository }}"
          echo "  - Usuario: ${{ github.actor }}"
          echo "  - Hora de inicio: ${{ needs.configuracion.outputs.timestamp }}"
          echo "  - Hora de fin: $(date +%H:%M:%S)"
          echo ""
          echo "âœ… Â¡Workflow completado exitosamente!"
          echo "========================================"
      
      # STEP 2: Subir archivos como artifacts
      - name: Guardar archivos generados
        uses: actions/upload-artifact@v3
        with:
          name: archivos-generados
          path: |
            prueba.txt
            resultado.txt