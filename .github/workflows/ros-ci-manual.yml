name: ROS 2 Installation Test

on:
  workflow_dispatch:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]

jobs:
  ros-installation:
    runs-on: ubuntu-22.04
    
    steps:
      - name: Checkout repository
        uses: actions/checkout@v3
      
      - name: Install ROS 2 Humble
        run: |
          # Actualizar sistema
          sudo apt update
          sudo apt upgrade -y
          
          # Instalar dependencias
          sudo apt install -y software-properties-common curl gnupg lsb-release
          
          # Agregar repositorio de ROS 2
          sudo curl -sSL https://raw.githubusercontent.com/ros/rosdistro/master/ros.key -o /usr/share/keyrings/ros-archive-keyring.gpg
          echo "deb [arch=$(dpkg --print-architecture) signed-by=/usr/share/keyrings/ros-archive-keyring.gpg] http://packages.ros.org/ros2/ubuntu $(lsb_release -cs) main" | sudo tee /etc/apt/sources.list.d/ros2.list > /dev/null
          
          # Instalar ROS 2
          sudo apt update
          sudo apt install -y ros-humble-ros-base
          
          # Instalar herramientas de desarrollo
          sudo apt install -y python3-rosdep python3-colcon-common-extensions
      
      - name: Initialize rosdep
        run: |
          sudo rosdep init || true
          rosdep update
      
      - name: Verify ROS 2 Installation
        run: |
          source /opt/ros/humble/setup.bash
          echo "========================================"
          echo "ROS 2 Installation Verification"
          echo "========================================"
          echo ""
          echo "ROS_DISTRO: $ROS_DISTRO"
          echo "ROS_VERSION: $ROS_VERSION"
          echo "ROS_PYTHON_VERSION: $ROS_PYTHON_VERSION"
          echo ""
          echo "Available ROS 2 commands:"
          which ros2
          echo ""
          echo "ROS 2 packages installed:"
          ros2 pkg list | head -10
          echo ""
          echo "Colcon version:"
          colcon version-check
          echo ""
          echo "âœ… ROS 2 Humble installed successfully!"