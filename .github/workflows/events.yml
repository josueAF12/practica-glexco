name: ğŸ“ Ejemplo Sencillo - Eventos GitHub Actions

on:
  # 1. EVENTO PUSH - Cuando haces commit y push
  push:
    branches: [main]
  
  # 2. EVENTO PULL REQUEST - Cuando creas o actualizas un PR
  pull_request:
    branches: [main]
  
  # 3. EVENTO MANUAL - Cuando ejecutas manualmente
  workflow_dispatch:
    inputs:
      ambiente:
        description: 'Â¿A quÃ© ambiente?'
        required: true
        default: 'pruebas'
        type: choice
        options:
          - pruebas
          - produccion
  
  # 4. EVENTO PROGRAMADO - Se ejecuta automÃ¡ticamente
  schedule:
    - cron: '30 14 * * *'  # Todos los dÃ­as a las 14:30 UTC

jobs:
  # Este job SIEMPRE se ejecuta, identifica quÃ© evento ocurriÃ³
  identificar-evento:
    name: ğŸ” Identificar Evento
    runs-on: ubuntu-latest
    
    steps:
      - name: Mostrar quÃ© evento nos activÃ³
        run: |
          echo "========================================"
          echo "ğŸ¯ ESTE WORKFLOW FUE ACTIVADO POR:"
          echo "========================================"
          
          if [[ "${{ github.event_name }}" == "push" ]]; then
            echo "ğŸ“¤ EVENTO: PUSH (Commit)"
            echo "ğŸ“ Mensaje: ${{ github.event.head_commit.message }}"
            echo "ğŸ‘¤ Autor: ${{ github.event.head_commit.author.name }}"
          elif [[ "${{ github.event_name }}" == "pull_request" ]]; then
            echo "ğŸ”€ EVENTO: PULL REQUEST"
            echo "#${{ github.event.pull_request.number }}: ${{ github.event.pull_request.title }}"
            echo "ğŸ‘¤ Creado por: ${{ github.event.pull_request.user.login }}"
          elif [[ "${{ github.event_name }}" == "workflow_dispatch" ]]; then
            echo "ğŸ‘† EVENTO: MANUAL"
            echo "ğŸ‘¤ Ejecutado por: ${{ github.actor }}"
            echo "ğŸ¯ Ambiente elegido: ${{ github.event.inputs.ambiente }}"
          elif [[ "${{ github.event_name }}" == "schedule" ]]; then
            echo "â° EVENTO: PROGRAMADO"
            echo "ğŸ•’ Hora actual: $(date)"
          fi
          
          echo "========================================"
          echo "ğŸ“ Repositorio: ${{ github.repository }}"
          echo "ğŸŒ¿ Rama: ${{ github.ref_name }}"
          echo "ğŸ”‘ Commit: ${GITHUB_SHA:0:8}"
          echo "========================================"

  # Este job solo para PUSH
  build-push:
    name: ğŸ—ï¸ Build (solo para push)
    runs-on: ubuntu-latest
    needs: identificar-evento
    if: github.event_name == 'push'  # Solo se ejecuta para push
    
    steps:
      - name: Descargar cÃ³digo
        uses: actions/checkout@v4
      
      - name: Mensaje para push
        run: |
          echo "âœ… Se hizo un push a la rama main"
          echo "ğŸ“¦ Esto podrÃ­a ser un proceso de build"
          echo "ğŸš€ Ejemplo: npm install && npm run build"

  # Este job solo para PULL REQUEST
  revisar-pr:
    name: ğŸ‘€ Revisar PR
    runs-on: ubuntu-latest
    needs: identificar-evento
    if: github.event_name == 'pull_request'  # Solo se ejecuta para PR
    
    steps:
      - name: Descargar cÃ³digo del PR
        uses: actions/checkout@v4
      
      - name: Mensaje para PR
        run: |
          echo "ğŸ” Revisando Pull Request..."
          echo "ğŸ“‹ Esto podrÃ­a incluir:"
          echo "   - Ejecutar tests"
          echo "   - Verificar estilo de cÃ³digo"
          echo "   - Revisar cobertura"

  # Este job solo para ejecuciÃ³n MANUAL
  despliegue-manual:
    name: ğŸš€ Despliegue Manual
    runs-on: ubuntu-latest
    needs: identificar-evento
    if: github.event_name == 'workflow_dispatch'  # Solo se ejecuta manualmente
    
    steps:
      - name: Mostrar parÃ¡metros
        run: |
          echo "ğŸ‘¤ Solicitado por: ${{ github.actor }}"
          echo "ğŸ¯ Ambiente: ${{ github.event.inputs.ambiente }}"
          
          if [[ "${{ github.event.inputs.ambiente }}" == "produccion" ]]; then
            echo "âš ï¸  Â¡ATENCIÃ“N! Desplegando a PRODUCCIÃ“N"
          else
            echo "ğŸ› ï¸  Desplegando a ambiente de PRUEBAS"
          fi

  # Este job solo para eventos PROGRAMADOS
  tarea-programada:
    name: ğŸ“… Tarea Programada
    runs-on: ubuntu-latest
    needs: identificar-evento
    if: github.event_name == 'schedule'  # Solo se ejecuta programado
    
    steps:
      - name: Ejecutar tarea automÃ¡tica
        run: |
          echo "ğŸ¤– Ejecutando tarea programada automÃ¡ticamente"
          echo "ğŸ“Š PodrÃ­a ser:"
          echo "   - Generar reportes diarios"
          echo "   - Hacer backup de datos"
          echo "   - Limpiar cachÃ©"

  # Este job SIEMPRE se ejecuta al final
  resumen-final:
    name: ğŸ“‹ Resumen Final
    runs-on: ubuntu-latest
    needs: 
      - identificar-evento
      - build-push
      - revisar-pr
      - despliegue-manual
      - tarea-programada
    if: always()  # Â¡Siempre se ejecuta!
    
    steps:
      - name: Mostrar resumen
        run: |
          echo "========================================"
          echo "           RESUMEN DE EJECUCIÃ“N         "
          echo "========================================"
          echo ""
          echo "ğŸ“Š Jobs ejecutados segÃºn el evento:"
          echo "   ğŸ” Identificar Evento: ${{ needs.identificar-evento.result }}"
          echo "   ğŸ—ï¸  Build (push): ${{ needs.build-push.result || 'No ejecutado' }}"
          echo "   ğŸ‘€ Revisar PR: ${{ needs.revisar-pr.result || 'No ejecutado' }}"
          echo "   ğŸš€ Despliegue Manual: ${{ needs.despliegue-manual.result || 'No ejecutado' }}"
          echo "   ğŸ“… Tarea Programada: ${{ needs.tarea-programada.result || 'No ejecutado' }}"
          echo ""
          echo "âœ… Workflow completado"
          echo "========================================"